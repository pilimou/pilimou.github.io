<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link href="css/jquery-ui.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/datepicker.css" rel="stylesheet">
    <link href="fontawesome-free-5.15.4-web/css/all.css" rel="stylesheet">
    <title>YO</title>
  </head>
  <body>
    <table id="mainTable" border="0">
      <tr>
        <td>
          <span>起</span>
        </td>
        <td><input type="text"
					class="form-control form-control-sm" id="startDate"
					name="startDate" style="width: 226px" autocomplete="off"
					onchange="changeDatefunc(this.id, this.value)"></td>
      </tr>
      <tr>
        <td>
          <span>迄</span>
        </td>
        <td Style="display: flex;"><input type="text"
					class="form-control form-control-sm" id="endDate" name="endDate"
					style="width: 226px" autocomplete="off"
					onchange="changeDatefunc(this.id, this.value)"></td>
      </tr>
    </table>
    <h1>倒數</h1>

    <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/moment.js"></script>
    <script type="text/javascript" src="js/datepicker.min.js"></script>
    <script type="text/javascript" src="js/datepicker.zh.js"></script>
    <script type="text/javascript" src="js/bootstrap-3.3.7.min.js"></script>
    <script>

      var d = new Date();
	    var endDay = new Date();
	    endDay.setDate(d.getDate() - 1);
	
	    $( "#startDate" ).datepicker({
		    timepicker: true,
	 	    language: 'zh',						 	  
	 	    minView: 'days', 
	 	    view: 'days',
	 	    dateFormat:"yyyy-mm-dd",	
	    });
	
	    $( "#endDate" ).datepicker({ 
		    timepicker: true,
	 	    language: 'zh',						 	  
	 	    minView: 'days', 
	 	    view: 'days',
	 	    dateFormat:"yyyy-mm-dd",
	    });

      function appendZero(obj) {
			  if (obj < 10) {
				  return "0" + obj;
			  } else {
			 	  return obj; 
			  }
	    }

      //input連動datepicker
   	  function changeDatefunc(id, value){
   		  var inputDate;
   		  var inputTime;
   		  if(moment(value, 'YYYY-MM-DD HH:mm',true).isValid()){
				  var inputArray = value.split(" ");
				  inputDate = inputArray[0].split("-");
				  inputTime = inputArray[1].split(":");
				  $("#" + id).data('datepicker').selectDate(
					  new Date(inputDate[0], inputDate[1] - 1, inputDate[2], inputTime[0], inputTime[1]));
		    }
	    }	

      init();
      function init(){
        //預設input顯示和datepicker日期
		    $( "#startDate" ).val(endDay.getFullYear() + '-' + appendZero(endDay.getMonth() + 1) + '-01');
		    $( "#endDate" ).val(d.getFullYear() + '-' + appendZero(d.getMonth() + 1) + '-' + appendZero(d.getDate()) + '-' + appendZero(d.getHours()) + ':' + appendZero(d.getMinutes()));
		    $("#startDate").data('datepicker').selectDate(new Date(endDay.getFullYear(), endDay.getMonth(), 1));
		    $("#endDate").data('datepicker').selectDate(new Date(d.getFullYear(), d.getMonth(), d.getDate(), d.getHours(), d.getMinutes()));
      }

    </script>
  </body>
</html>